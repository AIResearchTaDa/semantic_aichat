# ğŸ—ï¸ ĞÑ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸ â€” Ğ¡ĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡Ğ½Ğ¸Ğ¹ ĞŸĞ¾ÑˆÑƒĞº TA-DA!

## Ğ—Ğ¼Ñ–ÑÑ‚
- [ĞĞ³Ğ»ÑĞ´ Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ¸](#Ğ¾Ğ³Ğ»ÑĞ´-Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ¸)
- [ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸](#ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¸-ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸)
- [ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¸ Ğ´Ğ°Ğ½Ğ¸Ñ…](#Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¸-Ğ´Ğ°Ğ½Ğ¸Ñ…)
- [ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ¸ Ğ¿Ğ¾ÑˆÑƒĞºÑƒ](#Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ¸-Ğ¿Ğ¾ÑˆÑƒĞºÑƒ)
- [ĞšĞµÑˆÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ‚Ğ° Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ñ–Ğ·Ğ°Ñ†Ñ–Ñ](#ĞºĞµÑˆÑƒĞ²Ğ°Ğ½Ğ½Ñ-Ñ‚Ğ°-Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ñ–Ğ·Ğ°Ñ†Ñ–Ñ)
- [ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¾Ğ²Ğ°Ğ½Ñ–ÑÑ‚ÑŒ](#Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¾Ğ²Ğ°Ğ½Ñ–ÑÑ‚ÑŒ)

---

## ĞĞ³Ğ»ÑĞ´ Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ¸

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ğ¾Ğ±ÑƒĞ´Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ½Ğ° Ğ¼Ñ–ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ñ–ÑĞ½Ñ–Ğ¹ Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ– Ğ· Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½ÑĞ¼ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¸Ğ·Ğ°Ñ†Ñ–Ñ— Docker.

### Ğ’Ğ¸ÑĞ¾ĞºĞ¾Ñ€Ñ–Ğ²Ğ½ĞµĞ²Ğ° Ğ´Ñ–Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ĞšĞĞ Ğ˜Ğ¡Ğ¢Ğ£Ğ’ĞĞ§                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NGINX (Port 8080)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Static Files â”‚  â”‚ Reverse     â”‚  â”‚ SSE Support          â”‚   â”‚
â”‚  â”‚ (HTML/CSS/JS)â”‚  â”‚ Proxy       â”‚  â”‚ (Event Streaming)    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                 â”‚                 â”‚
          â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Static     â”‚  â”‚   FastAPI API    â”‚  â”‚   TA-DA API    â”‚
â”‚   Content    â”‚  â”‚   (Port 8000)    â”‚  â”‚   (External)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Elasticsearch â”‚  â”‚ Embedding    â”‚  â”‚  OpenAI      â”‚
â”‚ (Port 9200)   â”‚  â”‚ API (Ollama) â”‚  â”‚  GPT-4 API   â”‚
â”‚               â”‚  â”‚ (Port 9001)  â”‚  â”‚              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ â”‚ Products  â”‚ â”‚  â”‚ Qwen3-8B     â”‚  â”‚ gpt-4o-mini  â”‚
â”‚ â”‚ Index     â”‚ â”‚  â”‚ Q8_0         â”‚  â”‚              â”‚
â”‚ â”‚           â”‚ â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ â”‚ Vectors   â”‚ â”‚  â”‚ 4096 dims    â”‚  â”‚              â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚              â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸

### 1. Frontend (Web Client)

**Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ—:**
- Vanilla JavaScript (ES6+)
- HTML5 Ñ ÑĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡Ğ½Ğ¾Ñ Ñ€Ğ¾Ğ·Ğ¼Ñ–Ñ‚ĞºĞ¾Ñ
- CSS3 Ğ· Grid/Flexbox
- Server-Sent Events (SSE)

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ– Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–:**

#### 1.1. UI Manager
```javascript
// Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ ÑÑ‚Ğ¾Ñ€Ñ–Ğ½ĞºĞ°Ğ¼Ğ¸ Ñ‚Ğ° Ğ½Ğ°Ğ²Ñ–Ğ³Ğ°Ñ†Ñ–Ñ”Ñ
- welcomePage: ĞŸÑ€Ğ¸Ğ²Ñ–Ñ‚Ğ°Ğ»ÑŒĞ½Ğ° ÑÑ‚Ğ¾Ñ€Ñ–Ğ½ĞºĞ°
- simpleSearchPage: ĞšĞ»Ğ°ÑĞ¸Ñ‡Ğ½Ğ¸Ğ¹ Ğ¿Ğ¾ÑˆÑƒĞº
- chatSearchPage: AI Ñ‡Ğ°Ñ‚-Ğ¿Ğ¾ÑˆÑƒĞº
```

#### 1.2. Search Manager
```javascript
// ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° Ğ¿Ğ¾ÑˆÑƒĞºĞ¾Ğ²Ğ¸Ñ… Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ²
- performSimpleSearch(): ĞšĞ»Ğ°ÑĞ¸Ñ‡Ğ½Ğ¸Ğ¹ Ğ¿Ğ¾ÑˆÑƒĞº
- performChatSearch(): AI Ğ¿Ğ¾ÑˆÑƒĞº
- handleSSEStream(): ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° SSE Ğ¿Ğ¾Ñ‚Ğ¾ĞºÑƒ
```

#### 1.3. Cart Manager
```javascript
// Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ ĞºĞ¾ÑˆĞ¸ĞºĞ¾Ğ¼
- addToCart(): Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€
- removeFromCart(): Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€
- updateCartUI(): ĞĞ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ Ñ–Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ
```

#### 1.4. Product Renderer
```javascript
// Ğ’Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ–Ğ²
- renderProductCard(): ĞšĞ°Ñ€Ñ‚ĞºĞ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñƒ
- renderProductCarousel(): ĞšĞ°Ñ€ÑƒÑĞµĞ»ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ–Ğ²
- lazyLoadImages(): Ğ›Ñ–Ğ½Ğ¸Ğ²Ğµ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ
```

**ĞÑĞ¾Ğ±Ğ»Ğ¸Ğ²Ğ¾ÑÑ‚Ñ–:**
- ğŸ“± ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½ (mobile-first)
- âš¡ ĞĞ¿Ñ‚Ğ¸Ğ¼Ñ–Ğ·Ğ°Ñ†Ñ–Ñ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ñ–
- ğŸ¨ Ğ¡ÑƒÑ‡Ğ°ÑĞ½Ğ¸Ğ¹ UI/UX
- â™¿ Accessibility (ARIA labels)

---

### 2. Backend API (FastAPI)

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ĞºĞ¾Ğ´Ñƒ:**

```
backend/
â”œâ”€â”€ main.py                 # Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ¸Ğ¹ Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¾Ğº FastAPI
â”œâ”€â”€ search_logger.py        # Ğ›Ğ¾Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ¿Ğ¾ÑˆÑƒĞºÑƒ
â”œâ”€â”€ reindex_products.py     # Ğ ĞµÑ–Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ñ–Ñ
â””â”€â”€ requirements.txt        # Ğ—Ğ°Ğ»ĞµĞ¶Ğ½Ğ¾ÑÑ‚Ñ–
```

#### 2.1. Application Lifecycle

```python
@asynccontextmanager
async def lifespan(app: FastAPI):
    """Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ğ¶Ğ¸Ñ‚Ñ‚Ñ”Ğ²Ğ¸Ğ¼ Ñ†Ğ¸ĞºĞ»Ğ¾Ğ¼ Ğ´Ğ¾Ğ´Ğ°Ñ‚ĞºÑƒ"""
    # Startup
    - ĞŸÑ–Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ñ Ğ´Ğ¾ Elasticsearch
    - ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° Ñ–Ğ½Ğ´ĞµĞºÑÑƒ
    - Ğ†Ğ½Ñ–Ñ†Ñ–Ğ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ HTTP ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ñ–Ğ²
    - ĞŸÑ–Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° ĞºĞµÑˆÑ–Ğ²
    
    yield
    
    # Shutdown
    - Ğ—Ğ°ĞºÑ€Ğ¸Ñ‚Ñ‚Ñ Ğ·'Ñ”Ğ´Ğ½Ğ°Ğ½ÑŒ
    - ĞÑ‡Ğ¸Ñ‰ĞµĞ½Ğ½Ñ Ñ€ĞµÑÑƒÑ€ÑÑ–Ğ²
```

#### 2.2. Dependency Injection

```python
async def get_es_client() -> AsyncElasticsearch:
    """Singleton Elasticsearch ĞºĞ»Ñ–Ñ”Ğ½Ñ‚"""
    
async def get_http_client() -> httpx.AsyncClient:
    """Singleton HTTP ĞºĞ»Ñ–Ñ”Ğ½Ñ‚ Ğ´Ğ»Ñ embeddings"""
```

#### 2.3. ĞšĞµÑˆ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€

```python
class TimedLRUCache:
    """LRU ĞºĞµÑˆ Ğ· TTL Ğ´Ğ»Ñ embeddings"""
    
    def __init__(self, maxsize: int, ttl_seconds: int):
        self._cache: OrderedDict = OrderedDict()
        self._timestamps: Dict[str, float] = {}
        self._maxsize = maxsize
        self._ttl_seconds = ttl_seconds
    
    def get(self, key: str) -> Optional[Any]:
        """ĞÑ‚Ñ€Ğ¸Ğ¼Ğ°Ñ‚Ğ¸ Ğ· Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ¾Ñ TTL"""
        
    def put(self, key: str, value: Any):
        """Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ· LRU eviction"""
```

#### 2.4. Embedding Manager

```python
class EmbeddingManager:
    """Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ”Ñ Ñ‚Ğ° ĞºĞµÑˆÑƒĞ²Ğ°Ğ½Ğ½ÑĞ¼ embeddings"""
    
    async def get_embedding(self, text: str) -> List[float]:
        """ĞÑ‚Ñ€Ğ¸Ğ¼Ğ°Ñ‚Ğ¸ embedding Ğ· ĞºĞµÑˆĞµĞ¼"""
        # 1. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° ĞºĞµÑˆÑƒ
        # 2. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ embedding
        # 3. ĞšĞµÑˆÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñƒ
        
    async def batch_embeddings(self, texts: List[str]) -> List[List[float]]:
        """Batch Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ· Ğ¾Ğ±Ğ¼ĞµĞ¶ĞµĞ½Ğ½ÑĞ¼ ĞºĞ¾Ğ½ĞºÑƒÑ€ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚Ñ–"""
```

#### 2.5. Search Engine

```python
class SearchEngine:
    """Ğ¯Ğ´Ñ€Ğ¾ Ğ¿Ğ¾ÑˆÑƒĞºĞ¾Ğ²Ğ¾Ñ— ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸"""
    
    async def hybrid_search(
        self, 
        query: str, 
        k: int = 20
    ) -> List[Dict]:
        """Ğ“Ñ–Ğ±Ñ€Ğ¸Ğ´Ğ½Ğ¸Ğ¹ Ğ¿Ğ¾ÑˆÑƒĞº (vector + BM25)"""
        
    async def vector_search(
        self, 
        embedding: List[float], 
        k: int = 20
    ) -> List[Dict]:
        """Ğ’ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ğ¸Ğ¹ KNN Ğ¿Ğ¾ÑˆÑƒĞº"""
        
    async def bm25_search(
        self, 
        query: str, 
        k: int = 20
    ) -> List[Dict]:
        """ĞŸĞ¾Ğ²Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ğ¸Ğ¹ BM25 Ğ¿Ğ¾ÑˆÑƒĞº"""
```

#### 2.6. GPT Analyzer

```python
class GPTAnalyzer:
    """AI Ğ°Ğ½Ğ°Ğ»Ñ–Ğ· Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ² Ñ‚Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ñ–Ğ¹"""
    
    async def analyze_intent(
        self, 
        query: str,
        context: Optional[Dict] = None
    ) -> Dict:
        """Ğ’Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ Ğ½Ğ°Ğ¼Ñ–Ñ€Ñƒ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°"""
        
    async def generate_subqueries(
        self, 
        query: str,
        max_subqueries: int = 5
    ) -> List[str]:
        """Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ¿Ñ–Ğ´Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ²"""
        
    async def generate_recommendations(
        self, 
        query: str,
        products: List[Dict],
        top_k: int = 3
    ) -> List[Dict]:
        """ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ñ–Ğ·Ğ¾Ğ²Ğ°Ğ½Ñ– Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ñ–Ñ—"""
```

---

### 3. Elasticsearch

**ĞšĞ¾Ğ½Ñ„Ñ–Ğ³ÑƒÑ€Ğ°Ñ†Ñ–Ñ Ñ–Ğ½Ğ´ĞµĞºÑÑƒ:**

```json
{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 0,
    "analysis": {
      "analyzer": {
        "ukrainian_analyzer": {
          "type": "ukrainian"
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "uuid": { "type": "keyword" },
      "title_ua": { 
        "type": "text", 
        "analyzer": "ukrainian_analyzer",
        "fields": {
          "keyword": { "type": "keyword" }
        }
      },
      "title_ru": { 
        "type": "text",
        "fields": {
          "keyword": { "type": "keyword" }
        }
      },
      "description_ua": { 
        "type": "text",
        "analyzer": "ukrainian_analyzer"
      },
      "description_ru": { "type": "text" },
      "description_vector": {
        "type": "dense_vector",
        "dims": 4096,
        "index": true,
        "similarity": "cosine"
      },
      "category": { "type": "keyword" },
      "price": { "type": "float" },
      "in_stock": { "type": "boolean" },
      "sku": { "type": "keyword" },
      "good_code": { "type": "keyword" }
    }
  }
}
```

**ĞŸĞ»Ğ°Ğ³Ñ–Ğ½Ğ¸:**
- `analysis-ukrainian` â€” Ğ¼Ğ¾Ñ€Ñ„Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ‡Ğ½Ğ¸Ğ¹ Ğ°Ğ½Ğ°Ğ»Ñ–Ğ· ÑƒĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ¾Ñ— Ğ¼Ğ¾Ğ²Ğ¸

**ĞĞ¿Ñ‚Ğ¸Ğ¼Ñ–Ğ·Ğ°Ñ†Ñ–Ñ—:**
- `refresh_interval`: 30s (Ğ·Ğ¼ĞµĞ½ÑˆÑƒÑ” Ğ½Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ)
- `number_of_replicas`: 0 (Ğ´Ğ»Ñ dev/single node)
- Cosine similarity Ğ´Ğ»Ñ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ñ–Ğ²

---

### 4. Embedding Service (Ollama)

**ĞœĞ¾Ğ´ĞµĞ»ÑŒ:** `dengcao/Qwen3-Embedding-8B:Q8_0`

**Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸:**
- **Ğ Ğ¾Ğ·Ğ¼Ñ–Ñ€Ğ½Ñ–ÑÑ‚ÑŒ:** 4096 Ğ²Ğ¸Ğ¼Ñ–Ñ€Ñ–Ğ²
- **ĞšĞ²Ğ°Ğ½Ñ‚Ğ¸Ğ·Ğ°Ñ†Ñ–Ñ:** Q8_0 (8-bit)
- **ĞŸÑ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ĞºĞ° Ğ¼Ğ¾Ğ²:** Ğ‘Ğ°Ğ³Ğ°Ñ‚Ğ¾Ğ¼Ğ¾Ğ²Ğ½Ğ° (Ğ²ĞºĞ»ÑÑ‡Ğ°ÑÑ‡Ğ¸ ÑƒĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºÑƒ)
- **Ğ¨Ğ²Ğ¸Ğ´ĞºÑ–ÑÑ‚ÑŒ:** ~200-300ms Ğ½Ğ° Ğ·Ğ°Ğ¿Ğ¸Ñ‚

**API endpoint:**
```http
POST http://10.2.0.171:9001/api/embeddings
{
  "model": "dengcao/Qwen3-Embedding-8B:Q8_0",
  "prompt": "Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ embedding"
}
```

**Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ÑŒ:**
```json
{
  "embedding": [0.123, -0.456, ...],  // 4096 Ñ‡Ğ¸ÑĞµĞ»
  "model": "dengcao/Qwen3-Embedding-8B:Q8_0"
}
```

---

### 5. OpenAI GPT-4

**ĞœĞ¾Ğ´ĞµĞ»ÑŒ:** `gpt-4o-mini`

**Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½Ñ:**
1. **ĞĞ½Ğ°Ğ»Ñ–Ğ· intent** â€” Ğ²Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ Ñ‚Ğ¸Ğ¿Ñƒ Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñƒ
2. **Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ¿Ñ–Ğ´Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ²** â€” Ñ€Ğ¾Ğ·Ğ±Ğ¸Ñ‚Ñ‚Ñ ÑĞºĞ»Ğ°Ğ´Ğ½Ğ¸Ñ… Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ²
3. **Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ñ–Ñ—** â€” Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ñ–Ğ·Ğ¾Ğ²Ğ°Ğ½Ñ– Ğ¿Ğ¾Ñ€Ğ°Ğ´Ğ¸

**ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¸:**

#### Intent Analysis
```
ĞŸÑ€Ğ¾Ğ°Ğ½Ğ°Ğ»Ñ–Ğ·ÑƒĞ¹ Ğ·Ğ°Ğ¿Ğ¸Ñ‚ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ° Ñ–Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚-Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ñƒ TA-DA!

Ğ—Ğ°Ğ¿Ğ¸Ñ‚: "{query}"

Ğ’Ğ¸Ğ·Ğ½Ğ°Ñ‡:
1. intent: "product_search" | "clarification" | "invalid"
2. Ğ¯ĞºÑ‰Ğ¾ Ğ¿Ğ¾Ñ‚Ñ€Ñ–Ğ±Ğ½Ñ– ÑƒÑ‚Ğ¾Ñ‡Ğ½ĞµĞ½Ğ½Ñ, Ğ½Ğ°Ğ´Ğ°Ğ¹ Ñ—Ñ…
3. Ğ—Ğ³ĞµĞ½ĞµÑ€ÑƒĞ¹ 3-5 Ğ¿Ñ–Ğ´Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ² Ğ´Ğ»Ñ ÑĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ÑˆÑƒĞºÑƒ

Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ÑŒ Ñƒ JSON.
```

#### Recommendations
```
Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ñ–Ğ·Ğ¾Ğ²Ğ°Ğ½Ñ– Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ñ–Ñ— Ğ´Ğ»Ñ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¸Ñ… Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ–Ğ².

Ğ—Ğ°Ğ¿Ğ¸Ñ‚ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°: "{query}"

Ğ¢Ğ¾Ğ¿-3 Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¸:
{products}

Ğ”Ğ»Ñ ĞºĞ¾Ğ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñƒ Ğ¿Ğ¾ÑÑĞ½Ğ¸:
- Ğ§Ğ¾Ğ¼Ñƒ Ğ²Ñ–Ğ½ Ğ¿Ñ–Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑŒ
- ĞÑĞ½Ğ¾Ğ²Ğ½Ñ– Ğ¿ĞµÑ€ĞµĞ²Ğ°Ğ³Ğ¸
- Ğ”Ğ»Ñ ĞºĞ¾Ğ³Ğ¾ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒÑ”Ñ‚ÑŒÑÑ

Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ÑŒ Ñƒ JSON.
```

---

## ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¸ Ğ´Ğ°Ğ½Ğ¸Ñ…

### 1. ĞšĞ»Ğ°ÑĞ¸Ñ‡Ğ½Ğ¸Ğ¹ Ğ¿Ğ¾ÑˆÑƒĞº (Simple Search)

```
User Input
    â†“
Frontend (scripts.js)
    â†“ POST /search
Backend API
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ embedding  â”‚
â”‚    - ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° ĞºĞµÑˆÑƒ     â”‚
â”‚    - Ollama API         â”‚
â”‚    - ĞšĞµÑˆÑƒĞ²Ğ°Ğ½Ğ½Ñ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Elasticsearch Ğ¿Ğ¾ÑˆÑƒĞº  â”‚
â”‚    - KNN vector search  â”‚
â”‚    - BM25 text search   â”‚
â”‚    - Fusion results     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ–Ğ²  â”‚
â”‚    - Ğ¡Ğ¾Ñ€Ñ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ         â”‚
â”‚    - ĞŸĞ°Ğ³Ñ–Ğ½Ğ°Ñ†Ñ–Ñ          â”‚
â”‚    - Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
Frontend Rendering
    â†“
Display Results
```

**Ğ¢Ğ¸Ğ¿Ğ¾Ğ²Ğ¸Ğ¹ Ñ‡Ğ°Ñ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ½Ñ:**
- Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ embedding: 200-300ms
- Elasticsearch Ğ¿Ğ¾ÑˆÑƒĞº: 50-150ms
- ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ–Ğ²: 10-50ms
- **Ğ—Ğ°Ğ³Ğ°Ğ»Ğ¾Ğ¼:** 300-500ms

---

### 2. AI Ğ§Ğ°Ñ‚-Ğ¿Ğ¾ÑˆÑƒĞº (Chat Search)

```
User Query
    â†“
Frontend (scripts.js)
    â†“ GET /chat/search/sse
Backend API
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. GPT Intent Analysis   â”‚
â”‚    - Ğ’Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ intent   â”‚
â”‚    - Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ¿Ñ–Ğ´Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ²â”‚
â”‚    - SSE: event=intent   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
      â”‚  For each   â”‚
      â”‚  subquery   â”‚
      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ embedding   â”‚
â”‚    - Cache lookup        â”‚
â”‚    - Ollama API          â”‚
â”‚    - SSE: event=subquery â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Vector search         â”‚
â”‚    - KNN Ğ¿Ğ¾ÑˆÑƒĞº           â”‚
â”‚    - Score weighting     â”‚
â”‚    - Dedupe products     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
      â”‚  For each   â”‚
      â”‚  product    â”‚
      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Stream products       â”‚
â”‚    - SSE: event=product  â”‚
â”‚    - Real-time rendering â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ° Ñ„Ñ–Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ñ–Ñ  â”‚
â”‚    - Dynamic threshold   â”‚
â”‚    - Quality control     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. GPT Recommendations   â”‚
â”‚    - Top-K products      â”‚
â”‚    - Reasoning           â”‚
â”‚    - SSE: event=reco     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Ğ›Ğ¾Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ             â”‚
â”‚    - SearchLogger        â”‚
â”‚    - Session tracking    â”‚
â”‚    - Analytics           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
SSE: event=done
    â†“
Frontend Display
```

**Ğ¢Ğ¸Ğ¿Ğ¾Ğ²Ğ¸Ğ¹ Ñ‡Ğ°Ñ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ½Ñ:**
- GPT Ğ°Ğ½Ğ°Ğ»Ñ–Ğ·: 500-1000ms
- Embeddings (3 Ğ¿Ñ–Ğ´Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ğ¸): 600-900ms
- Elasticsearch (3 Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ğ¸): 150-450ms
- Ğ¤Ñ–Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ñ–Ñ: 50-100ms
- GPT Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ñ–Ñ—: 1000-1500ms
- **Ğ—Ğ°Ğ³Ğ°Ğ»Ğ¾Ğ¼:** 2500-4000ms

**SSE Timeline:**
```
0ms       â†’ event: intent
500ms     â†’ event: subquery (1/3)
700ms     â†’ event: subquery (2/3)
900ms     â†’ event: subquery (3/3)
1000ms    â†’ event: product (Ğ¿ĞµÑ€ÑˆĞ¸Ğ¹)
1050ms    â†’ event: product
...
1800ms    â†’ event: product (Ğ¾ÑÑ‚Ğ°Ğ½Ğ½Ñ–Ğ¹)
2000ms    â†’ event: recommendation (1/3)
2500ms    â†’ event: recommendation (2/3)
3000ms    â†’ event: recommendation (3/3)
3100ms    â†’ event: done
```

---

### 3. Lazy Loading

```
User scrolls
    â†“
Frontend detects scroll
    â†“ POST /chat/search/load-more
Backend API
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Lookup cached results â”‚
â”‚    - Session ID          â”‚
â”‚    - TTL check           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Slice products        â”‚
â”‚    - offset: 20          â”‚
â”‚    - limit: 20           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Return batch          â”‚
â”‚    - has_more flag       â”‚
â”‚    - total_available     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
Frontend appends
```

---

## ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ¸ Ğ¿Ğ¾ÑˆÑƒĞºÑƒ

### 1. Ğ“Ñ–Ğ±Ñ€Ğ¸Ğ´Ğ½Ğ¸Ğ¹ Ğ¿Ğ¾ÑˆÑƒĞº (Hybrid Search)

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:**

```python
def hybrid_search(query: str, k: int = 20, alpha: float = 0.7):
    """
    Ğ“Ñ–Ğ±Ñ€Ğ¸Ğ´Ğ½Ğ¸Ğ¹ Ğ¿Ğ¾ÑˆÑƒĞº Ğ· ĞºĞ¾Ğ¼Ğ±Ñ–Ğ½ÑƒĞ²Ğ°Ğ½Ğ½ÑĞ¼ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ° Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ÑˆÑƒĞºÑƒ
    
    Args:
        query: ĞŸĞ¾ÑˆÑƒĞºĞ¾Ğ²Ğ¸Ğ¹ Ğ·Ğ°Ğ¿Ğ¸Ñ‚
        k: ĞšÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ–Ğ²
        alpha: Ğ’Ğ°Ğ³Ğ° Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ÑˆÑƒĞºÑƒ (0-1)
    """
    
    # 1. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ embedding
    embedding = generate_embedding(query)
    
    # 2. ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ¸Ğ¹ Ğ¿Ğ¾ÑˆÑƒĞº
    vector_results = knn_search(embedding, k=k*2)
    bm25_results = text_search(query, k=k*2)
    
    # 3. ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ scores
    vector_scores = normalize_scores(vector_results)
    bm25_scores = normalize_scores(bm25_results)
    
    # 4. Weighted fusion
    combined = {}
    for product_id, vec_score in vector_scores.items():
        bm25_score = bm25_scores.get(product_id, 0)
        final_score = alpha * vec_score + (1 - alpha) * bm25_score
        combined[product_id] = final_score
    
    # 5. Ğ¡Ğ¾Ñ€Ñ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ‚Ğ° Ñ‚Ğ¾Ğ¿-K
    results = sorted(combined.items(), key=lambda x: x[1], reverse=True)[:k]
    
    return results
```

**ĞŸĞµÑ€ĞµĞ²Ğ°Ğ³Ğ¸:**
- âœ… Ğ¢Ğ¾Ñ‡Ğ½Ñ–ÑÑ‚ÑŒ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ÑˆÑƒĞºÑƒ
- âœ… Ğ¨Ğ²Ğ¸Ğ´ĞºÑ–ÑÑ‚ÑŒ BM25
- âœ… Ğ Ğ¾Ğ±Ğ°ÑÑ‚Ğ½Ñ–ÑÑ‚ÑŒ Ğ´Ğ¾ typos (BM25)
- âœ… Ğ¡ĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡Ğ½Ğ° ÑÑ…Ğ¾Ğ¶Ñ–ÑÑ‚ÑŒ (vectors)

---

### 2. ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ° Ñ„Ñ–Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ñ–Ñ

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** 
ĞŸÑ€Ğ¸ Ñ€Ñ–Ğ·Ğ½Ğ¸Ñ… Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ğ°Ñ… Ñ€Ğ¾Ğ·Ğ¿Ğ¾Ğ´Ñ–Ğ» scores Ğ¼Ğ¾Ğ¶Ğµ ÑĞ¸Ğ»ÑŒĞ½Ğ¾ Ğ²Ñ–Ğ´Ñ€Ñ–Ğ·Ğ½ÑÑ‚Ğ¸ÑÑ. Ğ¤Ñ–ĞºÑĞ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ğ¿Ğ¾Ñ€Ñ–Ğ³ Ğ¼Ğ¾Ğ¶Ğµ:
- Ğ’Ñ–Ğ´Ñ„Ñ–Ğ»ÑŒÑ‚Ñ€ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ·Ğ°Ğ½Ğ°Ğ´Ñ‚Ğ¾ Ğ±Ğ°Ğ³Ğ°Ñ‚Ğ¾ (Ğ²Ñ‚Ñ€Ğ°Ñ‚Ğ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ–Ğ²)
- Ğ—Ğ°Ğ»Ğ¸ÑˆĞ¸Ñ‚Ğ¸ Ğ·Ğ°Ğ½Ğ°Ğ´Ñ‚Ğ¾ Ğ¼Ğ°Ğ»Ğ¾ (Ğ¿Ğ¾Ğ³Ğ°Ğ½Ğ° ÑĞºÑ–ÑÑ‚ÑŒ)

**Ğ Ñ–ÑˆĞµĞ½Ğ½Ñ:**

```python
def adaptive_filtering(products: List[Dict], config: Dict) -> List[Dict]:
    """
    ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ° Ñ„Ñ–Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ñ–Ñ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ñ– ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ scores
    """
    if not products:
        return []
    
    # ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¸
    threshold_ratio = config['threshold_ratio']  # 0.4
    min_absolute = config['min_absolute']        # 0.3
    
    # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
    scores = [p['score'] for p in products]
    max_score = max(scores)
    mean_score = statistics.mean(scores)
    std_dev = statistics.stdev(scores) if len(scores) > 1 else 0
    
    # Ğ”Ğ¸Ğ½Ğ°Ğ¼Ñ–Ñ‡Ğ½Ğ¸Ğ¹ Ğ¿Ğ¾Ñ€Ñ–Ğ³
    dynamic_threshold = max_score * threshold_ratio
    
    # ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹ Ğ¼Ñ–Ğ½Ñ–Ğ¼ÑƒĞ¼ (Ğ´Ğ»Ñ Ğ¼Ğ°Ğ»Ğ¾Ñ— ĞºÑ–Ğ»ÑŒĞºĞ¾ÑÑ‚Ñ– Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ–Ğ²)
    if len(products) < 10:
        adaptive_min = min_absolute
    else:
        adaptive_min = max(mean_score - std_dev, min_absolute)
    
    # Ğ¤Ñ–Ğ½Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¹ Ğ¿Ğ¾Ñ€Ñ–Ğ³
    final_threshold = max(
        min(dynamic_threshold, adaptive_min),
        min_absolute
    )
    
    # Ğ¤Ñ–Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ñ–Ñ
    filtered = [p for p in products if p['score'] >= final_threshold]
    
    # Ğ“Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ğ¼Ñ–Ğ½Ñ–Ğ¼ÑƒĞ¼ (ÑĞºÑ‰Ğ¾ Ğ·Ğ°Ğ½Ğ°Ğ´Ñ‚Ğ¾ Ğ°Ğ³Ñ€ĞµÑĞ¸Ğ²Ğ½Ğ° Ñ„Ñ–Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ñ–Ñ)
    if len(filtered) < 3 and len(products) >= 3:
        filtered = sorted(products, key=lambda x: x['score'], reverse=True)[:10]
    
    return filtered
```

**ĞŸÑ€Ğ¸ĞºĞ»Ğ°Ğ´Ğ¸:**

| Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ñ–Ğ¹ | Max Score | Threshold | Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ |
|----------|-----------|-----------|-----------|
| Ğ¢Ğ¾Ñ‡Ğ½Ğ¸Ğ¹ Ğ·Ğ°Ğ¿Ğ¸Ñ‚ | 0.95 | 0.38 | Ğ¢Ğ¾Ğ¿ 15 Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ–Ğ² |
| Ğ Ğ¾Ğ·Ğ¼Ğ¸Ñ‚Ğ¸Ğ¹ Ğ·Ğ°Ğ¿Ğ¸Ñ‚ | 0.65 | 0.30 | Ğ¢Ğ¾Ğ¿ 25 Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ–Ğ² |
| ĞœĞ°Ğ»Ğ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ–Ğ² | 0.85 | 0.30 | Ğ’ÑÑ– 5 Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ–Ğ² |

---

### 3. Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ñ–ĞºĞ°Ñ†Ñ–Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ–Ğ²

ĞŸÑ€Ğ¸ Ğ¿Ğ¾ÑˆÑƒĞºÑƒ Ğ·Ğ° Ğ¿Ñ–Ğ´Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ğ°Ğ¼Ğ¸ Ğ¾Ğ´Ğ¸Ğ½ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ¼Ğ¾Ğ¶Ğµ Ğ·'ÑĞ²Ğ¸Ñ‚Ğ¸ÑÑ ĞºÑ–Ğ»ÑŒĞºĞ° Ñ€Ğ°Ğ·Ñ–Ğ².

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:**

```python
def deduplicate_products(
    products_by_subquery: List[List[Dict]]
) -> List[Dict]:
    """
    Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ñ–ĞºĞ°Ñ†Ñ–Ñ Ğ· Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ†Ñ–Ñ”Ñ scores
    """
    product_map = {}
    
    for subquery_idx, products in enumerate(products_by_subquery):
        # Ğ’Ğ°Ğ³Ğ° Ğ¿Ñ–Ğ´Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñƒ (Ğ¿ĞµÑ€ÑˆĞ¸Ğ¹ Ğ²Ğ°Ğ¶Ğ»Ğ¸Ğ²Ñ–ÑˆĞ¸Ğ¹)
        weight = config['weight_decay'] ** subquery_idx
        
        for product in products:
            uuid = product['uuid']
            
            if uuid not in product_map:
                product_map[uuid] = {
                    **product,
                    'aggregated_score': 0,
                    'appearance_count': 0,
                    'subquery_indices': []
                }
            
            # ĞĞ³Ñ€ĞµĞ³Ğ°Ñ†Ñ–Ñ score
            product_map[uuid]['aggregated_score'] += product['score'] * weight
            product_map[uuid]['appearance_count'] += 1
            product_map[uuid]['subquery_indices'].append(subquery_idx)
    
    # ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ
    for product in product_map.values():
        count = product['appearance_count']
        product['final_score'] = (
            product['aggregated_score'] / count * 
            (1 + 0.1 * (count - 1))  # Ğ‘Ğ¾Ğ½ÑƒÑ Ğ·Ğ° ĞºÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ğ¿Ğ¾ÑĞ²
        )
    
    # Ğ¡Ğ¾Ñ€Ñ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ
    results = sorted(
        product_map.values(),
        key=lambda x: x['final_score'],
        reverse=True
    )
    
    return results
```

**ĞŸĞµÑ€ĞµĞ²Ğ°Ğ³Ğ¸:**
- Ğ¢Ğ¾Ğ²Ğ°Ñ€Ğ¸, Ñ‰Ğ¾ Ğ¿Ñ–Ğ´Ñ…Ğ¾Ğ´ÑÑ‚ÑŒ Ğ¿Ñ–Ğ´ ĞºÑ–Ğ»ÑŒĞºĞ° ĞºÑ€Ğ¸Ñ‚ĞµÑ€Ñ–Ñ—Ğ², Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ÑƒÑÑ‚ÑŒ Ğ²Ğ¸Ñ‰Ğ¸Ğ¹ score
- Ğ—Ğ¼ĞµĞ½ÑˆĞµĞ½Ğ½Ñ weight Ğ´Ğ»Ñ Ğ½Ğ°ÑÑ‚ÑƒĞ¿Ğ½Ğ¸Ñ… Ğ¿Ñ–Ğ´Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ²
- Ğ‘Ğ¾Ğ½ÑƒÑ Ğ·Ğ° Ğ¿Ğ¾ÑĞ²Ñƒ Ğ² ĞºÑ–Ğ»ÑŒĞºĞ¾Ñ… Ğ¿Ñ–Ğ´Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ğ°Ñ…

---

## ĞšĞµÑˆÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ‚Ğ° Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ñ–Ğ·Ğ°Ñ†Ñ–Ñ

### 1. Embedding Cache

**Ğ ĞµĞ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ:**

```python
class TimedLRUCache:
    def __init__(self, maxsize: int = 2000, ttl_seconds: int = 3600):
        self._cache = OrderedDict()
        self._timestamps = {}
        self._maxsize = maxsize
        self._ttl_seconds = ttl_seconds
        self._lock = asyncio.Lock()
    
    async def get(self, key: str) -> Optional[Any]:
        async with self._lock:
            if key not in self._cache:
                return None
            
            # TTL check
            if time.time() - self._timestamps[key] > self._ttl_seconds:
                del self._cache[key]
                del self._timestamps[key]
                return None
            
            # LRU update
            self._cache.move_to_end(key)
            return self._cache[key]
    
    async def put(self, key: str, value: Any):
        async with self._lock:
            # Eviction
            if len(self._cache) >= self._maxsize:
                oldest_key = next(iter(self._cache))
                del self._cache[oldest_key]
                del self._timestamps[oldest_key]
            
            self._cache[key] = value
            self._timestamps[key] = time.time()
            self._cache.move_to_end(key)
```

**ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸:**
- Hit rate: ~36%
- Ğ¡ĞµÑ€ĞµĞ´Ğ½Ñ” ĞµĞºĞ¾Ğ½Ğ¾Ğ¼Ñ–Ñ Ñ‡Ğ°ÑÑƒ: 200-300ms Ğ½Ğ° hit
- Ğ Ğ¾Ğ·Ğ¼Ñ–Ñ€: 2000 entries (~50MB RAM)

---

### 2. Search Results Cache

ĞšĞµÑˆÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ–Ğ² Ñ‡Ğ°Ñ‚-Ğ¿Ğ¾ÑˆÑƒĞºÑƒ Ğ´Ğ»Ñ lazy loading.

```python
class SearchResultsCache:
    def __init__(self, ttl_seconds: int = 3600):
        self._cache: Dict[str, Dict] = {}
        self._timestamps: Dict[str, float] = {}
        self._ttl_seconds = ttl_seconds
    
    def store(self, session_id: str, results: List[Dict]):
        self._cache[session_id] = {
            'products': results,
            'total': len(results)
        }
        self._timestamps[session_id] = time.time()
    
    def get_batch(
        self, 
        session_id: str, 
        offset: int, 
        limit: int
    ) -> Optional[Dict]:
        if session_id not in self._cache:
            return None
        
        # TTL check
        if time.time() - self._timestamps[session_id] > self._ttl_seconds:
            del self._cache[session_id]
            del self._timestamps[session_id]
            return None
        
        products = self._cache[session_id]['products']
        batch = products[offset:offset + limit]
        
        return {
            'products': batch,
            'has_more': offset + limit < len(products),
            'total_available': len(products)
        }
```

---

### 3. Connection Pooling

```python
# HTTP ĞºĞ»Ñ–Ñ”Ğ½Ñ‚ Ğ· connection pooling
http_client = httpx.AsyncClient(
    timeout=httpx.Timeout(30.0),
    limits=httpx.Limits(
        max_connections=100,
        max_keepalive_connections=20
    )
)

# Elasticsearch Ğ· connection pooling
es_client = AsyncElasticsearch(
    [settings.elastic_url],
    max_retries=3,
    retry_on_timeout=True,
    request_timeout=30
)
```

---

### 4. Batch Processing

```python
async def batch_generate_embeddings(
    texts: List[str],
    max_concurrent: int = 2
) -> List[List[float]]:
    """
    ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ embeddings Ğ· Ğ¾Ğ±Ğ¼ĞµĞ¶ĞµĞ½Ğ½ÑĞ¼ ĞºĞ¾Ğ½ĞºÑƒÑ€ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚Ñ–
    """
    semaphore = asyncio.Semaphore(max_concurrent)
    
    async def _generate_with_semaphore(text: str):
        async with semaphore:
            return await generate_embedding(text)
    
    tasks = [_generate_with_semaphore(text) for text in texts]
    embeddings = await asyncio.gather(*tasks)
    
    return embeddings
```

---

## ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¾Ğ²Ğ°Ğ½Ñ–ÑÑ‚ÑŒ

### ĞŸĞ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ° ĞºĞ¾Ğ½Ñ„Ñ–Ğ³ÑƒÑ€Ğ°Ñ†Ñ–Ñ (Single Node)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   nginx:8080        â”‚
â”‚   â”œâ”€ Static files   â”‚
â”‚   â””â”€ Reverse proxy  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   api:8000          â”‚
â”‚   Single instance   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   elasticsearch     â”‚
â”‚   Single node       â”‚
â”‚   No replicas       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞĞ±Ğ¼ĞµĞ¶ĞµĞ½Ğ½Ñ:**
- ĞĞ´Ğ¸Ğ½ API Ñ–Ğ½ÑÑ‚Ğ°Ğ½Ñ
- ĞĞ´Ğ¸Ğ½ ES node
- ĞĞµĞ¼Ğ°Ñ” HA (High Availability)

---

### ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¾Ğ²Ğ°Ğ½Ğ° ĞºĞ¾Ğ½Ñ„Ñ–Ğ³ÑƒÑ€Ğ°Ñ†Ñ–Ñ (Production)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Load       â”‚
                    â”‚  Balancer   â”‚
                    â”‚  (Nginx)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Pod 1    â”‚ â”‚   API Pod 2    â”‚ â”‚   API Pod 3   â”‚
â”‚   (FastAPI)    â”‚ â”‚   (FastAPI)    â”‚ â”‚   (FastAPI)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ES Master 1   â”‚ â”‚  ES Master 2   â”‚ â”‚  ES Master 3  â”‚
â”‚                â”‚ â”‚                â”‚ â”‚               â”‚
â”‚  + Data Node   â”‚ â”‚  + Data Node   â”‚ â”‚  + Data Node  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    Cluster coordination
```

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ñ–Ñ—:**

1. **API Layer:**
   - ĞœÑ–Ğ½Ñ–Ğ¼ÑƒĞ¼ 2-3 Ñ–Ğ½ÑÑ‚Ğ°Ğ½ÑĞ¸
   - Kubernetes HPA (Horizontal Pod Autoscaler)
   - Shared Redis Ğ´Ğ»Ñ ĞºĞµÑˆÑƒ
   - Sticky sessions Ğ´Ğ»Ñ SSE

2. **Elasticsearch:**
   - 3 master nodes
   - 2+ data nodes
   - Replicas: 1-2
   - Cross-zone deployment

3. **ĞšĞµÑˆÑƒĞ²Ğ°Ğ½Ğ½Ñ:**
   - Redis Cluster Ğ´Ğ»Ñ embedding cache
   - Shared Ğ¼Ñ–Ğ¶ API Ñ–Ğ½ÑÑ‚Ğ°Ğ½ÑĞ°Ğ¼Ğ¸
   - Persistence (AOF)

4. **ĞœĞ¾Ğ½Ñ–Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³:**
   - Prometheus + Grafana
   - ELK Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ñ–Ğ²
   - AlertManager

---

**Ğ’ĞµÑ€ÑÑ–Ñ:** 1.0.0  
**Ğ”Ğ°Ñ‚Ğ° Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ:** 13 Ğ¶Ğ¾Ğ²Ñ‚Ğ½Ñ 2025

