# üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º–∏ ‚Äî –°–µ–º–∞–Ω—Ç–∏—á–Ω–∏–π –ü–æ—à—É–∫ TA-DA!

## –ó–º—ñ—Å—Ç
- [–û–≥–ª—è–¥ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏](#–æ–≥–ª—è–¥-–∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏)
- [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Å–∏—Å—Ç–µ–º–∏](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏-—Å–∏—Å—Ç–µ–º–∏)
- [–ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–∏—Ö](#–ø–æ—Ç–æ–∫–∏-–¥–∞–Ω–∏—Ö)
- [–ê–ª–≥–æ—Ä–∏—Ç–º–∏ –ø–æ—à—É–∫—É](#–∞–ª–≥–æ—Ä–∏—Ç–º–∏-–ø–æ—à—É–∫—É)
- [–ö–µ—à—É–≤–∞–Ω–Ω—è —Ç–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è](#–∫–µ—à—É–≤–∞–Ω–Ω—è-—Ç–∞-–æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è)
- [–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å](#–º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å)

---

## –û–≥–ª—è–¥ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

–°–∏—Å—Ç–µ–º–∞ –ø–æ–±—É–¥–æ–≤–∞–Ω–∞ –Ω–∞ –º—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å–Ω—ñ–π –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—ñ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü—ñ—ó Docker.

### –í–∏—Å–æ–∫–æ—Ä—ñ–≤–Ω–µ–≤–∞ –¥—ñ–∞–≥—Ä–∞–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        –ö–û–†–ò–°–¢–£–í–ê–ß                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    NGINX (Port 8080)                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ Static Files ‚îÇ  ‚îÇ Reverse     ‚îÇ  ‚îÇ SSE Support          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ (HTML/CSS/JS)‚îÇ  ‚îÇ Proxy       ‚îÇ  ‚îÇ (Event Streaming)    ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ                 ‚îÇ                 ‚îÇ
          ‚ñº                 ‚ñº                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Static     ‚îÇ  ‚îÇ   FastAPI API    ‚îÇ  ‚îÇ   TA-DA API    ‚îÇ
‚îÇ   Content    ‚îÇ  ‚îÇ   (Port 8000)    ‚îÇ  ‚îÇ   (External)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                  ‚îÇ                  ‚îÇ
        ‚ñº                  ‚ñº                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Elasticsearch ‚îÇ  ‚îÇ Embedding    ‚îÇ  ‚îÇ  OpenAI      ‚îÇ
‚îÇ (Port 9200)   ‚îÇ  ‚îÇ API (Ollama) ‚îÇ  ‚îÇ  GPT-4 API   ‚îÇ
‚îÇ               ‚îÇ  ‚îÇ (Port 9001)  ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ ‚îÇ Products  ‚îÇ ‚îÇ  ‚îÇ Qwen3-8B     ‚îÇ  ‚îÇ gpt-4o-mini  ‚îÇ
‚îÇ ‚îÇ Index     ‚îÇ ‚îÇ  ‚îÇ Q8_0         ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ ‚îÇ           ‚îÇ ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ ‚îÇ Vectors   ‚îÇ ‚îÇ  ‚îÇ 4096 dims    ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Å–∏—Å—Ç–µ–º–∏

### 1. Frontend (Web Client)

**–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó:**
- Vanilla JavaScript (ES6+)
- HTML5 —Å —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ—é —Ä–æ–∑–º—ñ—Ç–∫–æ—é
- CSS3 –∑ Grid/Flexbox
- Server-Sent Events (SSE)

**–û—Å–Ω–æ–≤–Ω—ñ –º–æ–¥—É–ª—ñ:**

#### 1.1. UI Manager
```javascript
// –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞–º–∏ —Ç–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—î—é
- welcomePage: –ü—Ä–∏–≤—ñ—Ç–∞–ª—å–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞
- simpleSearchPage: –ö–ª–∞—Å–∏—á–Ω–∏–π –ø–æ—à—É–∫
- chatSearchPage: AI —á–∞—Ç-–ø–æ—à—É–∫
```

#### 1.2. Search Manager
```javascript
// –û–±—Ä–æ–±–∫–∞ –ø–æ—à—É–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
- performSimpleSearch(): –ö–ª–∞—Å–∏—á–Ω–∏–π –ø–æ—à—É–∫
- performChatSearch(): AI –ø–æ—à—É–∫
- handleSSEStream(): –û–±—Ä–æ–±–∫–∞ SSE –ø–æ—Ç–æ–∫—É
```

#### 1.3. Cart Manager
```javascript
// –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—à–∏–∫–æ–º
- addToCart(): –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä
- removeFromCart(): –í–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–≤–∞—Ä
- updateCartUI(): –û–Ω–æ–≤–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```

#### 1.4. Product Renderer
```javascript
// –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤
- renderProductCard(): –ö–∞—Ä—Ç–∫–∞ —Ç–æ–≤–∞—Ä—É
- renderProductCarousel(): –ö–∞—Ä—É—Å–µ–ª—å —Ç–æ–≤–∞—Ä—ñ–≤
- lazyLoadImages(): –õ—ñ–Ω–∏–≤–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω—å
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- üì± –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –¥–∏–∑–∞–π–Ω (mobile-first)
- ‚ö° –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- üé® –°—É—á–∞—Å–Ω–∏–π UI/UX
- ‚ôø Accessibility (ARIA labels)

---

### 2. Backend API (FastAPI)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥—É:**

```
backend/
‚îú‚îÄ‚îÄ main.py                 # –ì–æ–ª–æ–≤–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫ FastAPI
‚îú‚îÄ‚îÄ search_logger.py        # –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ—à—É–∫—É
‚îú‚îÄ‚îÄ reindex_products.py     # –†–µ—ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—è
‚îî‚îÄ‚îÄ requirements.txt        # –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
```

#### 2.1. Application Lifecycle

```python
@asynccontextmanager
async def lifespan(app: FastAPI):
    """–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∂–∏—Ç—Ç—î–≤–∏–º —Ü–∏–∫–ª–æ–º –¥–æ–¥–∞—Ç–∫—É"""
    # Startup
    - –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Elasticsearch
    - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ–Ω–¥–µ–∫—Å—É
    - –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è HTTP –∫–ª—ñ—î–Ω—Ç—ñ–≤
    - –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–µ—à—ñ–≤
    
    yield
    
    # Shutdown
    - –ó–∞–∫—Ä–∏—Ç—Ç—è –∑'—î–¥–Ω–∞–Ω—å
    - –û—á–∏—â–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤
```

#### 2.2. Dependency Injection

```python
async def get_es_client() -> AsyncElasticsearch:
    """Singleton Elasticsearch –∫–ª—ñ—î–Ω—Ç"""
    
async def get_http_client() -> httpx.AsyncClient:
    """Singleton HTTP –∫–ª—ñ—î–Ω—Ç –¥–ª—è embeddings"""
```

#### 2.3. –ö–µ—à –º–µ–Ω–µ–¥–∂–µ—Ä

```python
class TimedLRUCache:
    """LRU –∫–µ—à –∑ TTL –¥–ª—è embeddings"""
    
    def __init__(self, maxsize: int, ttl_seconds: int):
        self._cache: OrderedDict = OrderedDict()
        self._timestamps: Dict[str, float] = {}
        self._maxsize = maxsize
        self._ttl_seconds = ttl_seconds
    
    def get(self, key: str) -> Optional[Any]:
        """–û—Ç—Ä–∏–º–∞—Ç–∏ –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é TTL"""
        
    def put(self, key: str, value: Any):
        """–î–æ–¥–∞—Ç–∏ –∑ LRU eviction"""
```

#### 2.4. Embedding Manager

```python
class EmbeddingManager:
    """–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—î—é —Ç–∞ –∫–µ—à—É–≤–∞–Ω–Ω—è–º embeddings"""
    
    async def get_embedding(self, text: str) -> List[float]:
        """–û—Ç—Ä–∏–º–∞—Ç–∏ embedding –∑ –∫–µ—à–µ–º"""
        # 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–µ—à—É
        # 2. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ embedding
        # 3. –ö–µ—à—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        
    async def batch_embeddings(self, texts: List[str]) -> List[List[float]]:
        """Batch –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—ñ"""
```

#### 2.5. Search Engine

```python
class SearchEngine:
    """–Ø–¥—Ä–æ –ø–æ—à—É–∫–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏"""
    
    async def hybrid_search(
        self, 
        query: str, 
        k: int = 20
    ) -> List[Dict]:
        """–ì—ñ–±—Ä–∏–¥–Ω–∏–π –ø–æ—à—É–∫ (vector + BM25)"""
        
    async def vector_search(
        self, 
        embedding: List[float], 
        k: int = 20
    ) -> List[Dict]:
        """–í–µ–∫—Ç–æ—Ä–Ω–∏–π KNN –ø–æ—à—É–∫"""
        
    async def bm25_search(
        self, 
        query: str, 
        k: int = 20
    ) -> List[Dict]:
        """–ü–æ–≤–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–∏–π BM25 –ø–æ—à—É–∫"""
```

#### 2.6. GPT Analyzer

```python
class GPTAnalyzer:
    """AI –∞–Ω–∞–ª—ñ–∑ –∑–∞–ø–∏—Ç—ñ–≤ —Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π"""
    
    async def analyze_intent(
        self, 
        query: str,
        context: Optional[Dict] = None
    ) -> Dict:
        """–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–º—ñ—Ä—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"""
        
    async def generate_subqueries(
        self, 
        query: str,
        max_subqueries: int = 5
    ) -> List[str]:
        """–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø—ñ–¥–∑–∞–ø–∏—Ç—ñ–≤"""
        
    async def generate_recommendations(
        self, 
        query: str,
        products: List[Dict],
        top_k: int = 3
    ) -> List[Dict]:
        """–ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó"""
```

---

### 3. Elasticsearch

**–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —ñ–Ω–¥–µ–∫—Å—É:**

```json
{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 0,
    "analysis": {
      "analyzer": {
        "ukrainian_analyzer": {
          "type": "ukrainian"
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "uuid": { "type": "keyword" },
      "title_ua": { 
        "type": "text", 
        "analyzer": "ukrainian_analyzer",
        "fields": {
          "keyword": { "type": "keyword" }
        }
      },
      "title_ru": { 
        "type": "text",
        "fields": {
          "keyword": { "type": "keyword" }
        }
      },
      "description_ua": { 
        "type": "text",
        "analyzer": "ukrainian_analyzer"
      },
      "description_ru": { "type": "text" },
      "description_vector": {
        "type": "dense_vector",
        "dims": 4096,
        "index": true,
        "similarity": "cosine"
      },
      "category": { "type": "keyword" },
      "price": { "type": "float" },
      "in_stock": { "type": "boolean" },
      "sku": { "type": "keyword" },
      "good_code": { "type": "keyword" }
    }
  }
}
```

**–ü–ª–∞–≥—ñ–Ω–∏:**
- `analysis-ukrainian` ‚Äî –º–æ—Ä—Ñ–æ–ª–æ–≥—ñ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó –º–æ–≤–∏

**–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:**
- `refresh_interval`: 30s (–∑–º–µ–Ω—à—É—î –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è)
- `number_of_replicas`: 0 (–¥–ª—è dev/single node)
- Cosine similarity –¥–ª—è –≤–µ–∫—Ç–æ—Ä—ñ–≤

---

### 4. Embedding Service (Ollama)

**–ú–æ–¥–µ–ª—å:** `dengcao/Qwen3-Embedding-8B:Q8_0`

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- **–†–æ–∑–º—ñ—Ä–Ω—ñ—Å—Ç—å:** 4096 –≤–∏–º—ñ—Ä—ñ–≤
- **–ö–≤–∞–Ω—Ç–∏–∑–∞—Ü—ñ—è:** Q8_0 (8-bit)
- **–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –º–æ–≤:** –ë–∞–≥–∞—Ç–æ–º–æ–≤–Ω–∞ (–≤–∫–ª—é—á–∞—é—á–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫—É)
- **–®–≤–∏–¥–∫—ñ—Å—Ç—å:** ~200-300ms –Ω–∞ –∑–∞–ø–∏—Ç

**API endpoint:**
```http
POST http://10.2.0.171:9001/api/embeddings
{
  "model": "dengcao/Qwen3-Embedding-8B:Q8_0",
  "prompt": "—Ç–µ–∫—Å—Ç –¥–ª—è embedding"
}
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "embedding": [0.123, -0.456, ...],  // 4096 —á–∏—Å–µ–ª
  "model": "dengcao/Qwen3-Embedding-8B:Q8_0"
}
```

---

### 5. OpenAI GPT-4

**–ú–æ–¥–µ–ª—å:** `gpt-4o-mini`

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
1. **–ê–Ω–∞–ª—ñ–∑ intent** ‚Äî –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∏–ø—É –∑–∞–ø–∏—Ç—É
2. **–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø—ñ–¥–∑–∞–ø–∏—Ç—ñ–≤** ‚Äî —Ä–æ–∑–±–∏—Ç—Ç—è —Å–∫–ª–∞–¥–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
3. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó** ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø–æ—Ä–∞–¥–∏

**–ü—Ä–æ–º–ø—Ç–∏:**

#### Intent Analysis
```
–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –∑–∞–ø–∏—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω—É TA-DA!

–ó–∞–ø–∏—Ç: "{query}"

–í–∏–∑–Ω–∞—á:
1. intent: "product_search" | "clarification" | "invalid"
2. –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —É—Ç–æ—á–Ω–µ–Ω–Ω—è, –Ω–∞–¥–∞–π —ó—Ö
3. –ó–≥–µ–Ω–µ—Ä—É–π 3-5 –ø—ñ–¥–∑–∞–ø–∏—Ç—ñ–≤ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ–≥–æ –ø–æ—à—É–∫—É

–í—ñ–¥–ø–æ–≤—ñ–¥—å —É JSON.
```

#### Recommendations
```
–°—Ç–≤–æ—Ä–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –∑–Ω–∞–π–¥–µ–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤.

–ó–∞–ø–∏—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: "{query}"

–¢–æ–ø-3 —Ç–æ–≤–∞—Ä–∏:
{products}

–î–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É –ø–æ—è—Å–Ω–∏:
- –ß–æ–º—É –≤—ñ–Ω –ø—ñ–¥—Ö–æ–¥–∏—Ç—å
- –û—Å–Ω–æ–≤–Ω—ñ –ø–µ—Ä–µ–≤–∞–≥–∏
- –î–ª—è –∫–æ–≥–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è

–í—ñ–¥–ø–æ–≤—ñ–¥—å —É JSON.
```

---

## –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–∏—Ö

### 1. –ö–ª–∞—Å–∏—á–Ω–∏–π –ø–æ—à—É–∫ (Simple Search)

```
User Input
    ‚Üì
Frontend (scripts.js)
    ‚Üì POST /search
Backend API
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è embedding  ‚îÇ
‚îÇ    - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–µ—à—É     ‚îÇ
‚îÇ    - Ollama API         ‚îÇ
‚îÇ    - –ö–µ—à—É–≤–∞–Ω–Ω—è          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. Elasticsearch –ø–æ—à—É–∫  ‚îÇ
‚îÇ    - KNN vector search  ‚îÇ
‚îÇ    - BM25 text search   ‚îÇ
‚îÇ    - Fusion results     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. –û–±—Ä–æ–±–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤  ‚îÇ
‚îÇ    - –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è         ‚îÇ
‚îÇ    - –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è          ‚îÇ
‚îÇ    - –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚Üì
Frontend Rendering
    ‚Üì
Display Results
```

**–¢–∏–ø–æ–≤–∏–π —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:**
- –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è embedding: 200-300ms
- Elasticsearch –ø–æ—à—É–∫: 50-150ms
- –û–±—Ä–æ–±–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤: 10-50ms
- **–ó–∞–≥–∞–ª–æ–º:** 300-500ms

---

### 2. AI –ß–∞—Ç-–ø–æ—à—É–∫ (Chat Search)

```
User Query
    ‚Üì
Frontend (scripts.js)
    ‚Üì GET /chat/search/sse
Backend API
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. GPT Intent Analysis   ‚îÇ
‚îÇ    - –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è intent   ‚îÇ
‚îÇ    - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø—ñ–¥–∑–∞–ø–∏—Ç—ñ–≤‚îÇ
‚îÇ    - SSE: event=intent   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ  For each   ‚îÇ
      ‚îÇ  subquery   ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è embedding   ‚îÇ
‚îÇ    - Cache lookup        ‚îÇ
‚îÇ    - Ollama API          ‚îÇ
‚îÇ    - SSE: event=subquery ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. Vector search         ‚îÇ
‚îÇ    - KNN –ø–æ—à—É–∫           ‚îÇ
‚îÇ    - Score weighting     ‚îÇ
‚îÇ    - Dedupe products     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ  For each   ‚îÇ
      ‚îÇ  product    ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. Stream products       ‚îÇ
‚îÇ    - SSE: event=product  ‚îÇ
‚îÇ    - Real-time rendering ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 5. –ê–¥–∞–ø—Ç–∏–≤–Ω–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è  ‚îÇ
‚îÇ    - Dynamic threshold   ‚îÇ
‚îÇ    - Quality control     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 6. GPT Recommendations   ‚îÇ
‚îÇ    - Top-K products      ‚îÇ
‚îÇ    - Reasoning           ‚îÇ
‚îÇ    - SSE: event=reco     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 7. –õ–æ–≥—É–≤–∞–Ω–Ω—è             ‚îÇ
‚îÇ    - SearchLogger        ‚îÇ
‚îÇ    - Session tracking    ‚îÇ
‚îÇ    - Analytics           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
SSE: event=done
    ‚Üì
Frontend Display
```

**–¢–∏–ø–æ–≤–∏–π —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:**
- GPT –∞–Ω–∞–ª—ñ–∑: 500-1000ms
- Embeddings (3 –ø—ñ–¥–∑–∞–ø–∏—Ç–∏): 600-900ms
- Elasticsearch (3 –∑–∞–ø–∏—Ç–∏): 150-450ms
- –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è: 50-100ms
- GPT —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó: 1000-1500ms
- **–ó–∞–≥–∞–ª–æ–º:** 2500-4000ms

**SSE Timeline:**
```
0ms       ‚Üí event: intent
500ms     ‚Üí event: subquery (1/3)
700ms     ‚Üí event: subquery (2/3)
900ms     ‚Üí event: subquery (3/3)
1000ms    ‚Üí event: product (–ø–µ—Ä—à–∏–π)
1050ms    ‚Üí event: product
...
1800ms    ‚Üí event: product (–æ—Å—Ç–∞–Ω–Ω—ñ–π)
2000ms    ‚Üí event: recommendation (1/3)
2500ms    ‚Üí event: recommendation (2/3)
3000ms    ‚Üí event: recommendation (3/3)
3100ms    ‚Üí event: done
```

---

### 3. Lazy Loading

```
User scrolls
    ‚Üì
Frontend detects scroll
    ‚Üì POST /chat/search/load-more
Backend API
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. Lookup cached results ‚îÇ
‚îÇ    - Session ID          ‚îÇ
‚îÇ    - TTL check           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. Slice products        ‚îÇ
‚îÇ    - offset: 20          ‚îÇ
‚îÇ    - limit: 20           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. Return batch          ‚îÇ
‚îÇ    - has_more flag       ‚îÇ
‚îÇ    - total_available     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
Frontend appends
```

---

## –ê–ª–≥–æ—Ä–∏—Ç–º–∏ –ø–æ—à—É–∫—É

### 1. –ì—ñ–±—Ä–∏–¥–Ω–∏–π –ø–æ—à—É–∫ (Hybrid Search)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

```python
def hybrid_search(query: str, k: int = 20, alpha: float = 0.7):
    """
    –ì—ñ–±—Ä–∏–¥–Ω–∏–π –ø–æ—à—É–∫ –∑ –∫–æ–º–±—ñ–Ω—É–≤–∞–Ω–Ω—è–º –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ —Ç–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ—à—É–∫—É
    
    Args:
        query: –ü–æ—à—É–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç
        k: –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
        alpha: –í–∞–≥–∞ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ—à—É–∫—É (0-1)
    """
    
    # 1. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è embedding
    embedding = generate_embedding(query)
    
    # 2. –ü–∞—Ä–∞–ª–µ–ª—å–Ω–∏–π –ø–æ—à—É–∫
    vector_results = knn_search(embedding, k=k*2)
    bm25_results = text_search(query, k=k*2)
    
    # 3. –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è scores
    vector_scores = normalize_scores(vector_results)
    bm25_scores = normalize_scores(bm25_results)
    
    # 4. Weighted fusion
    combined = {}
    for product_id, vec_score in vector_scores.items():
        bm25_score = bm25_scores.get(product_id, 0)
        final_score = alpha * vec_score + (1 - alpha) * bm25_score
        combined[product_id] = final_score
    
    # 5. –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —Ç–æ–ø-K
    results = sorted(combined.items(), key=lambda x: x[1], reverse=True)[:k]
    
    return results
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚úÖ –¢–æ—á–Ω—ñ—Å—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ—à—É–∫—É
- ‚úÖ –®–≤–∏–¥–∫—ñ—Å—Ç—å BM25
- ‚úÖ –†–æ–±–∞—Å—Ç–Ω—ñ—Å—Ç—å –¥–æ typos (BM25)
- ‚úÖ –°–µ–º–∞–Ω—Ç–∏—á–Ω–∞ —Å—Ö–æ–∂—ñ—Å—Ç—å (vectors)

---

### 2. –ê–¥–∞–ø—Ç–∏–≤–Ω–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è

**–ü—Ä–æ–±–ª–µ–º–∞:** 
–ü—Ä–∏ —Ä—ñ–∑–Ω–∏—Ö –∑–∞–ø–∏—Ç–∞—Ö —Ä–æ–∑–ø–æ–¥—ñ–ª scores –º–æ–∂–µ —Å–∏–ª—å–Ω–æ –≤—ñ–¥—Ä—ñ–∑–Ω—è—Ç–∏—Å—è. –§—ñ–∫—Å–æ–≤–∞–Ω–∏–π –ø–æ—Ä—ñ–≥ –º–æ–∂–µ:
- –í—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –∑–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ (–≤—Ç—Ä–∞—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤)
- –ó–∞–ª–∏—à–∏—Ç–∏ –∑–∞–Ω–∞–¥—Ç–æ –º–∞–ª–æ (–ø–æ–≥–∞–Ω–∞ —è–∫—ñ—Å—Ç—å)

**–†—ñ—à–µ–Ω–Ω—è:**

```python
def adaptive_filtering(products: List[Dict], config: Dict) -> List[Dict]:
    """
    –ê–¥–∞–ø—Ç–∏–≤–Ω–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ scores
    """
    if not products:
        return []
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä–∏
    threshold_ratio = config['threshold_ratio']  # 0.4
    min_absolute = config['min_absolute']        # 0.3
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    scores = [p['score'] for p in products]
    max_score = max(scores)
    mean_score = statistics.mean(scores)
    std_dev = statistics.stdev(scores) if len(scores) > 1 else 0
    
    # –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –ø–æ—Ä—ñ–≥
    dynamic_threshold = max_score * threshold_ratio
    
    # –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –º—ñ–Ω—ñ–º—É–º (–¥–ª—è –º–∞–ª–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤)
    if len(products) < 10:
        adaptive_min = min_absolute
    else:
        adaptive_min = max(mean_score - std_dev, min_absolute)
    
    # –§—ñ–Ω–∞–ª—å–Ω–∏–π –ø–æ—Ä—ñ–≥
    final_threshold = max(
        min(dynamic_threshold, adaptive_min),
        min_absolute
    )
    
    # –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è
    filtered = [p for p in products if p['score'] >= final_threshold]
    
    # –ì–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–∏–π –º—ñ–Ω—ñ–º—É–º (—è–∫—â–æ –∑–∞–Ω–∞–¥—Ç–æ –∞–≥—Ä–µ—Å–∏–≤–Ω–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è)
    if len(filtered) < 3 and len(products) >= 3:
        filtered = sorted(products, key=lambda x: x['score'], reverse=True)[:10]
    
    return filtered
```

**–ü—Ä–∏–∫–ª–∞–¥–∏:**

| –°—Ü–µ–Ω–∞—Ä—ñ–π | Max Score | Threshold | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|-----------|-----------|-----------|
| –¢–æ—á–Ω–∏–π –∑–∞–ø–∏—Ç | 0.95 | 0.38 | –¢–æ–ø 15 —Ç–æ–≤–∞—Ä—ñ–≤ |
| –†–æ–∑–º–∏—Ç–∏–π –∑–∞–ø–∏—Ç | 0.65 | 0.30 | –¢–æ–ø 25 —Ç–æ–≤–∞—Ä—ñ–≤ |
| –ú–∞–ª–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ | 0.85 | 0.30 | –í—Å—ñ 5 —Ç–æ–≤–∞—Ä—ñ–≤ |

---

### 3. –î–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—è —Ç–æ–≤–∞—Ä—ñ–≤

–ü—Ä–∏ –ø–æ—à—É–∫—É –∑–∞ –ø—ñ–¥–∑–∞–ø–∏—Ç–∞–º–∏ –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –º–æ–∂–µ –∑'—è–≤–∏—Ç–∏—Å—è –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤.

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

```python
def deduplicate_products(
    products_by_subquery: List[List[Dict]]
) -> List[Dict]:
    """
    –î–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—è –∑ –∞–≥—Ä–µ–≥–∞—Ü—ñ—î—é scores
    """
    product_map = {}
    
    for subquery_idx, products in enumerate(products_by_subquery):
        # –í–∞–≥–∞ –ø—ñ–¥–∑–∞–ø–∏—Ç—É (–ø–µ—Ä—à–∏–π –≤–∞–∂–ª–∏–≤—ñ—à–∏–π)
        weight = config['weight_decay'] ** subquery_idx
        
        for product in products:
            uuid = product['uuid']
            
            if uuid not in product_map:
                product_map[uuid] = {
                    **product,
                    'aggregated_score': 0,
                    'appearance_count': 0,
                    'subquery_indices': []
                }
            
            # –ê–≥—Ä–µ–≥–∞—Ü—ñ—è score
            product_map[uuid]['aggregated_score'] += product['score'] * weight
            product_map[uuid]['appearance_count'] += 1
            product_map[uuid]['subquery_indices'].append(subquery_idx)
    
    # –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è
    for product in product_map.values():
        count = product['appearance_count']
        product['final_score'] = (
            product['aggregated_score'] / count * 
            (1 + 0.1 * (count - 1))  # –ë–æ–Ω—É—Å –∑–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ—è–≤
        )
    
    # –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
    results = sorted(
        product_map.values(),
        key=lambda x: x['final_score'],
        reverse=True
    )
    
    return results
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- –¢–æ–≤–∞—Ä–∏, —â–æ –ø—ñ–¥—Ö–æ–¥—è—Ç—å –ø—ñ–¥ –∫—ñ–ª—å–∫–∞ –∫—Ä–∏—Ç–µ—Ä—ñ—ó–≤, –æ—Ç—Ä–∏–º—É—é—Ç—å –≤–∏—â–∏–π score
- –ó–º–µ–Ω—à–µ–Ω–Ω—è weight –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –ø—ñ–¥–∑–∞–ø–∏—Ç—ñ–≤
- –ë–æ–Ω—É—Å –∑–∞ –ø–æ—è–≤—É –≤ –∫—ñ–ª—å–∫–æ—Ö –ø—ñ–¥–∑–∞–ø–∏—Ç–∞—Ö

---

## –ö–µ—à—É–≤–∞–Ω–Ω—è —Ç–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è

### 1. Embedding Cache

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:**

```python
class TimedLRUCache:
    def __init__(self, maxsize: int = 2000, ttl_seconds: int = 3600):
        self._cache = OrderedDict()
        self._timestamps = {}
        self._maxsize = maxsize
        self._ttl_seconds = ttl_seconds
        self._lock = asyncio.Lock()
    
    async def get(self, key: str) -> Optional[Any]:
        async with self._lock:
            if key not in self._cache:
                return None
            
            # TTL check
            if time.time() - self._timestamps[key] > self._ttl_seconds:
                del self._cache[key]
                del self._timestamps[key]
                return None
            
            # LRU update
            self._cache.move_to_end(key)
            return self._cache[key]
    
    async def put(self, key: str, value: Any):
        async with self._lock:
            # Eviction
            if len(self._cache) >= self._maxsize:
                oldest_key = next(iter(self._cache))
                del self._cache[oldest_key]
                del self._timestamps[oldest_key]
            
            self._cache[key] = value
            self._timestamps[key] = time.time()
            self._cache.move_to_end(key)
```

**–ú–µ—Ç—Ä–∏–∫–∏:**
- Hit rate: ~36%
- –°–µ—Ä–µ–¥–Ω—î –µ–∫–æ–Ω–æ–º—ñ—è —á–∞—Å—É: 200-300ms –Ω–∞ hit
- –†–æ–∑–º—ñ—Ä: 2000 entries (~50MB RAM)

---

### 2. Search Results Cache

–ö–µ—à—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —á–∞—Ç-–ø–æ—à—É–∫—É –¥–ª—è lazy loading.

```python
class SearchResultsCache:
    def __init__(self, ttl_seconds: int = 3600):
        self._cache: Dict[str, Dict] = {}
        self._timestamps: Dict[str, float] = {}
        self._ttl_seconds = ttl_seconds
    
    def store(self, session_id: str, results: List[Dict]):
        self._cache[session_id] = {
            'products': results,
            'total': len(results)
        }
        self._timestamps[session_id] = time.time()
    
    def get_batch(
        self, 
        session_id: str, 
        offset: int, 
        limit: int
    ) -> Optional[Dict]:
        if session_id not in self._cache:
            return None
        
        # TTL check
        if time.time() - self._timestamps[session_id] > self._ttl_seconds:
            del self._cache[session_id]
            del self._timestamps[session_id]
            return None
        
        products = self._cache[session_id]['products']
        batch = products[offset:offset + limit]
        
        return {
            'products': batch,
            'has_more': offset + limit < len(products),
            'total_available': len(products)
        }
```

---

### 3. Connection Pooling

```python
# HTTP –∫–ª—ñ—î–Ω—Ç –∑ connection pooling
http_client = httpx.AsyncClient(
    timeout=httpx.Timeout(30.0),
    limits=httpx.Limits(
        max_connections=100,
        max_keepalive_connections=20
    )
)

# Elasticsearch –∑ connection pooling
es_client = AsyncElasticsearch(
    [settings.elastic_url],
    max_retries=3,
    retry_on_timeout=True,
    request_timeout=30
)
```

---

### 4. Batch Processing

```python
async def batch_generate_embeddings(
    texts: List[str],
    max_concurrent: int = 2
) -> List[List[float]]:
    """
    –ü–∞—Ä–∞–ª–µ–ª—å–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è embeddings –∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—ñ
    """
    semaphore = asyncio.Semaphore(max_concurrent)
    
    async def _generate_with_semaphore(text: str):
        async with semaphore:
            return await generate_embedding(text)
    
    tasks = [_generate_with_semaphore(text) for text in texts]
    embeddings = await asyncio.gather(*tasks)
    
    return embeddings
```

---

## –ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å

### –ü–æ—Ç–æ—á–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (Single Node)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   nginx:8080        ‚îÇ
‚îÇ   ‚îú‚îÄ Static files   ‚îÇ
‚îÇ   ‚îî‚îÄ Reverse proxy  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   api:8000          ‚îÇ
‚îÇ   Single instance   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   elasticsearch     ‚îÇ
‚îÇ   Single node       ‚îÇ
‚îÇ   No replicas       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–û–±–º–µ–∂–µ–Ω–Ω—è:**
- –û–¥–∏–Ω API —ñ–Ω—Å—Ç–∞–Ω—Å
- –û–¥–∏–Ω ES node
- –ù–µ–º–∞—î HA (High Availability)

---

### –ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (Production)

```
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  Load       ‚îÇ
                    ‚îÇ  Balancer   ‚îÇ
                    ‚îÇ  (Nginx)    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                  ‚îÇ                  ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   API Pod 1    ‚îÇ ‚îÇ   API Pod 2    ‚îÇ ‚îÇ   API Pod 3   ‚îÇ
‚îÇ   (FastAPI)    ‚îÇ ‚îÇ   (FastAPI)    ‚îÇ ‚îÇ   (FastAPI)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                  ‚îÇ                  ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                  ‚îÇ                  ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ES Master 1   ‚îÇ ‚îÇ  ES Master 2   ‚îÇ ‚îÇ  ES Master 3  ‚îÇ
‚îÇ                ‚îÇ ‚îÇ                ‚îÇ ‚îÇ               ‚îÇ
‚îÇ  + Data Node   ‚îÇ ‚îÇ  + Data Node   ‚îÇ ‚îÇ  + Data Node  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                  ‚îÇ                  ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    Cluster coordination
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**

1. **API Layer:**
   - –ú—ñ–Ω—ñ–º—É–º 2-3 —ñ–Ω—Å—Ç–∞–Ω—Å–∏
   - Kubernetes HPA (Horizontal Pod Autoscaler)
   - Shared Redis –¥–ª—è –∫–µ—à—É
   - Sticky sessions –¥–ª—è SSE

2. **Elasticsearch:**
   - 3 master nodes
   - 2+ data nodes
   - Replicas: 1-2
   - Cross-zone deployment

3. **–ö–µ—à—É–≤–∞–Ω–Ω—è:**
   - Redis Cluster –¥–ª—è embedding cache
   - Shared –º—ñ–∂ API —ñ–Ω—Å—Ç–∞–Ω—Å–∞–º–∏
   - Persistence (AOF)

4. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥:**
   - Prometheus + Grafana
   - ELK –¥–ª—è –ª–æ–≥—ñ–≤
   - AlertManager

---

**–í–µ—Ä—Å—ñ—è:** 1.0.0  
**–î–∞—Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:** 13 –∂–æ–≤—Ç–Ω—è 2025

